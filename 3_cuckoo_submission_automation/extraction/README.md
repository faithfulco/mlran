# Cuckoo Report File Extractor

## Overview

This script automates the extraction of key files generated by Cuckoo Sandbox after an analysis task is completed. It ensures that the necessary files are organized into specific directories for easy access and further processing.

The script performs the following actions:
1. Extracts the **binary**, **report.json**, **stats.log**, and **raw zipped results**.
2. Organizes the files into pre-defined directories.
3. Gracefully handles errors by skipping file extraction if an error (matching the error pattern specified in the script) is detected during the analysis.
4. Logs the extraction process for monitoring and debugging purposes.

---

## Prerequisites

- Python 2.7 installed in your environment.
- Cuckoo Sandbox properly installed and running.
- Access to the `site-packages` directory inside the virtual environment where Cuckoo is installed.

---

## Installation

### 1. Locate the `site-packages` Directory
To find the `site-packages` directory inside the virtual environment created for Cuckoo:
1. Navigate to the virtual environment folder.
2. Open the `lib` folder.
3. Inside the `lib` folder, open the `python2.7` folder.
4. Inside `python2.7`, locate the `site-packages` folder.
5. Inside `site-packages`, locate the `cuckoo` folder.

Alternatively, use the following command to locate the `site-packages` directory:
```bash
python2.7 -m site
```
Run this command within your virtual environment to get accurate paths.

### 2. Create a Custom Folder
Inside the `site-packages/cuckoo` folder:
1. Create a new folder, e.g., `custom`.
2. Place the `resultextraction.py` script inside this folder.
3. Add an empty `__init__.py` file to the `custom` folder to make it a Python package:
   ```bash
   touch __init__.py
   ```

### 3. Update the `schedule.py` File
1. Navigate to the `cuckoo/core/schedule.py` file.
2. Make a backup of the file in another location:
   ```bash
   cp schedule.py schedule_backup.py
   ```
   The backup file will be used if the schedule.py is unintentionally modified and cannot be restored to its original state.
   
3. Import the `ResultExtraction` class:
   ```python
   from cuckoo.custom.resultextraction import ResultExtraction
   ```
4. Locate the `def run(self):` function and find the `finally` block at the end of the function. Add the following line as the last line in the `finally` block:
   ```python
   ResultExtraction.extractfiles(self.task.id)
   ```

---

## Configuration

### Directories
By default, the `resultextraction.py` script uses the following directories for storage:

- **Parent Directory**: `~/Downloads/Uploads`
- **Output Directories**:
  - Binaries: `~/Downloads/Uploads/Binaries`
  - Reports: `~/Downloads/Uploads/Reports`
  - Stats: `~/Downloads/Uploads/Stats`
  - Raw Results: `~/Downloads/Uploads/RawResults`

If you wish to modify these paths, edit the following variables in the `resultextraction.py` script:
```python
parent_directory = os.path.expanduser("~/Downloads/Uploads")
output_binary_directory = os.path.join(storage_directory, "Binaries")
output_report_directory = os.path.join(storage_directory, "Reports")
output_stats_directory = os.path.join(storage_directory, "Stats")
output_raw_result_zip_directory = os.path.join(storage_directory, "RawResults")
```

---

## Usage

1. **Triggering the Script**:
   The script runs automatically at the end of each Cuckoo analysis when integrated into the `schedule.py` file.

2. **Extracted Files**:
   - **Binary**: Saved in the `Binaries` folder.
   - **Report (JSON)**: Saved in the `Reports` folder.
   - **Stats (log)**: Saved in the `Stats` folder.
   - **Raw Results (ZIP)**: Saved in the `RawResults` folder.

3. **Error Handling**:
   - The script checks for errors in the `cuckoo.log` file. If an error is found, file extraction is skipped for that task, and an appropriate log message is recorded.

---

## Logging

Logs are stored using Python's logging module. Review logs for detailed insights into the extraction process:
- Successful extractions
- Errors during file processing

---

## Notes

- Ensure that the storage directories are writable by the user running Cuckoo.
- If modifications to the script are required, back up the existing files.

---

## Troubleshooting

1. **Files Not Extracted**:
   - Check if errors were logged in `cuckoo.log`.
   - Ensure the specified directories exist and have the correct permissions.

2. **Script Not Triggering**:
   - Verify the `schedule.py` modifications.
   - Ensure that the `custom` folder and its modules are correctly imported.

3. **Unexpected Errors**:
   - Review the traceback in the logs.
   - Ensure the input paths (`path_to_binary`, `path_to_report_file`, etc.) are correctly configured.

---

Feel free to adapt the script to your specific needs. For support or contributions, open an issue or submit a pull request to the repository.

